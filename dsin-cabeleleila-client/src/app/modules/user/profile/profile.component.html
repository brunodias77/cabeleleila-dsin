<section id="profile" class="w-full h-screen">
  <div class="max-w-screen-xl mx-auto text-center">
    <div class="w-full items-start justify-between md:flex">
      <div class="max-w-lg">
        <h3 class="text-white text-xl font-bold sm:text-2xl">
          Seus Agendamentos
        </h3>
        <p class="text-gray-400 mt-2">
          Acompanhe o historico de seus agendamentos na Cabeleleila Leila
        </p>
      </div>
      <app-button
        class="mt-3 md:mt-0"
        (click)="openModal()"
        label="Agendar um horário"
        color="success"
      ></app-button>
    </div>

    <div class="mt-12">
      <ng-container *ngIf="appointments.length; else emptyState">
        <app-appointment-table
          [appointments]="appointments"
          (onUpdate)="updateAppointment($event)"
          (onDelete)="deleteAppointment($event)"
        ></app-appointment-table>
      </ng-container>
      <ng-template #emptyState>
        <div class="text-white h-screen flex items-center justify-center">
          <span>Você ainda não possui agendamentos na Cabeleleila Leila</span>
        </div>
      </ng-template>
    </div>

    <app-appointment-modal
      *ngIf="isOpen"
      [title]="'Novo Agendamento'"
      (onClose)="closeModal()"
    >
      <form (submit)="handleSubmit($event)">
        <div class="mb-4">
          <label for="date" class="block text-gray-700 font-bold mb-2"
            >Data:</label
          >
          <input
            id="date"
            type="date"
            name="date"
            class="w-full border border-gray-300 rounded px-3 py-2"
            [min]="today"
            required
          />
        </div>

        <div class="mb-4">
          <label for="services" class="block text-gray-700 font-bold mb-2"
            >Serviços:</label
          >
          <select
            id="services"
            name="services"
            class="w-full border border-gray-300 rounded px-3 py-2"
            [(ngModel)]="newOption"
          >
            <option *ngFor="let service of services" [value]="service.id">
              {{ service.name }} - R$ {{ service.price }}
            </option>
          </select>
        </div>

        <button
          type="button"
          class="bg-green-500 hover:bg-green-600 text-white font-bold py-1 px-2 rounded"
          (click)="addOption(newOption)"
          [disabled]="!newOption"
        >
          Adicionar Serviço
        </button>

        <div class="mt-4">
          <p *ngIf="selectedOptions.length > 0" class="font-bold mb-2">
            Selecionados:
          </p>
          <div
            *ngFor="let option of selectedOptions"
            class="flex items-center mb-2"
          >
            <span class="mr-2">{{ getServiceName(option) }}</span>
            <button
              type="button"
              class="text-red-500 hover:text-red-600 font-bold"
              (click)="removeOption(option)"
            >
              Remover
            </button>
          </div>
        </div>

        <div class="mt-6 flex justify-end space-x-4">
          <button
            type="button"
            class="bg-gray-500 hover:bg-gray-600 text-white font-bold py-2 px-4 rounded"
            (click)="closeModal()"
          >
            Cancelar
          </button>
          <button
            type="submit"
            class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded"
          >
            Agendar
          </button>
        </div>
      </form>
    </app-appointment-modal>

    <app-updated-appointment-modal
      *ngIf="modalUpdateAppointmentIsOpen"
      [title]="'Novo Agendamento'"
      (onClose)="closeModal()"
    >
      <form (submit)="handleSubmitUpdate($event)">
        <div class="mb-4">
          <label for="date" class="block text-gray-700 font-bold mb-2"
            >Data:</label
          >
          <input
            id="date"
            type="date"
            name="date"
            [value]="appointmentUpdate?.appointmentDate || ''"
            class="w-full border border-gray-300 rounded px-3 py-2"
            [min]="today"
            required
            [(ngModel)]="appointmentUpdate!.appointmentDate"
          />

          <div class="mb-4">
            <label for="services" class="block text-gray-700 font-bold mb-2"
              >Serviços:</label
            >
            <select
              id="services"
              name="services"
              class="w-full border border-gray-300 rounded px-3 py-2"
              [(ngModel)]="appointmentUpdate"
            >
              <option [value]="appointmentUpdate?.id" disabled selected>
                <ng-container *ngIf="appointmentUpdate?.services?.length">
                  <ng-container
                    *ngFor="let service of appointmentUpdate?.services"
                  >
                    {{ service.serviceName }} - R$ {{ service.servicePrice }}
                  </ng-container>
                </ng-container>
              </option>
              <option *ngFor="let service of services" [value]="service.id">
                {{ service.name }} - R$ {{ service.price }}
              </option>
            </select>
          </div>

          <div class="mt-6 flex justify-end space-x-4">
            <button
              type="button"
              class="bg-gray-500 hover:bg-gray-600 text-white font-bold py-2 px-4 rounded"
              (click)="closeUpdateAppointmentModal()"
            >
              Cancelar
            </button>
            <button
              type="submit"
              class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded"
            >
              Alterar
            </button>
          </div>
        </div>
      </form>
    </app-updated-appointment-modal>
  </div>
</section>
